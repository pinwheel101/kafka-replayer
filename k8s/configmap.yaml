apiVersion: v1
kind: ConfigMap
metadata:
  name: kafka-replayer-config
  namespace: default
  labels:
    app: kafka-replayer
data:
  application.yaml: |
    # Kafka Time-Synced Replayer Configuration

    hdfs:
      # 외부 HDFS 클러스터 (환경변수로 오버라이드 가능)
      uri: "${HDFS_URI:hdfs://external-hdfs-namenode:8020}"
      user: "${HDFS_USER:hadoop}"
      inputPath: "${HDFS_INPUT_PATH:/replay/prepared}"

      # Kerberos 설정 (필요시)
      kerberosEnabled: false
      kerberosPrincipal: ""
      kerberosKeytab: ""

    kafka:
      # 클러스터 내부 Kafka (Service DNS)
      bootstrapServers: "${KAFKA_BOOTSTRAP_SERVERS:kafka-service:9092}"
      topic: "${KAFKA_TOPIC:events-replay}"

      # Producer 최적화 설정
      acks: "all"
      batchSize: 65536           # 64KB
      lingerMs: 5
      bufferMemory: 134217728    # 128MB
      maxInFlightRequests: 5
      retries: 3
      retryBackoffMs: 100
      compressionType: "snappy"

      # 보안 설정 (필요시)
      securityProtocol: "PLAINTEXT"
      saslMechanism: ""
      saslJaasConfig: ""

    replay:
      # 모드: TIME_SYNCED (시간 동기화) 또는 SEQUENTIAL (순차)
      mode: "${REPLAY_MODE:TIME_SYNCED}"

      # 재생 속도 (TIME_SYNCED 모드)
      # 1.0 = 실시간, 2.0 = 2배속, 0.5 = 0.5배속
      speedFactor: ${REPLAY_SPEED:1.0}

      # 이벤트 간 지연 (SEQUENTIAL 모드, ms)
      delayMs: ${REPLAY_DELAY_MS:0}

      # 청크 단위 (시간)
      chunkHours: 1

      # 타이머 설정
      timerTickMs: 1
      timerWheelSize: 65536

      # 병렬 처리 (SEQUENTIAL 모드)
      parallelism: 4

      # 청크 처리 후 GC 실행
      gcAfterChunk: true

      # 다음 청크 미리 로드
      preloadNextChunk: true

    metrics:
      enabled: true
      port: 9090
      path: "/metrics"

    checkpoint:
      enabled: true
      # PVC 마운트 경로
      path: "/app/checkpoints/kafka-replayer-checkpoint.json"
      intervalSeconds: 60
